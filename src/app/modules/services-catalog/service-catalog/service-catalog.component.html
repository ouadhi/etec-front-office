<!-- <formio formKey="testimadservice"></formio> -->

<div class="app-service-catalog">
	<ng-container [ngTemplateOutlet]="alerts"></ng-container>

	<div fxLayout="row" class="service-page-title">
		<img src="/assets/images/page-title.jpg" />
	</div>

	<!-- <div class="app-daily-report">
		<div class="daily-reports fly-icon">
			<div class="app-card">
				<div class="chart">
					<div class="chart-details">
						<h4 class="chart-title">{{ 'CATALOG.Active tasks' | translate }}</h4>
						<h4 class="chart-count">{{ requestsTotalCount }}</h4>
					</div>
					<div class="chart-icon">
						<span class="icon">
							<i class="fa fa-tasks"></i>
						</span>
					</div>
				</div>
			</div>
		</div>
	</div> -->

	<div
		fxLayout="row"
		fxLayoutAlign="center top"
		class="service-search"
		*ngIf="showDashboardCounters"
	>
		<div class="" fxFlex.lt-lg="100" fxFlex.lt-xl="90" fxFlex.xl="83">
			<div class="header">
				<h1>{{ 'CATALOG.Total Requests' | translate }}</h1>
			</div>

			<div class="app-daily-report">
				<div class="row daily-reports">
					<div class="col-md-3">
						<div class="app-card">
							<div class="chart">
								<div class="chart-details">
									<h4 class="chart-title">{{ 'CATALOG.Active tasks' | translate }}</h4>
									<h4 class="chart-count">{{ requestsTotalCount }}</h4>
								</div>
								<div class="chart-icon">
									<span class="icon">
										<i class="fa fa-tasks"></i>
									</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div fxLayout="row" fxLayoutAlign="center top" class="service-search">
		<div class="" fxFlex.lt-lg="100" fxFlex.lt-xl="90" fxFlex.xl="83">
			<div class="header">
				<h1>{{ 'CATALOG.SERVICE_CATALOG_SEARCH_TITLE' | translate }}</h1>
			</div>
			<div class="filtersSection__keyword">
				<div class="form-group mb-0">
					<select class="form-control h-100" (change)="changeTap($event.target.value, departments)">
						<option [value]="-1">
							{{ 'CATALOG.ALL_DEPARTMENTS' | translate }}
						</option>
						<option [value]="i" *ngFor="let x of departments; let i = index">
							{{ x['departmentName_' + switchLangService.current] }}
						</option>
					</select>
				</div>
				<input
					class="form-control mx-3"
					[(ngModel)]="keyword"
					placeholder="{{ 'CATALOG.SEARCH_KEYWORD_BY_SERVICE_NAME' | translate }}"
				/>
				<button class="search" mat-button (click)="filterKeyword()">
					{{ 'CATALOG.SEARCH' | translate }}
				</button>
			</div>
		</div>
	</div>

	<app-page>
		<div class="services-container">
			<div class="service-header">
				<div class="grid-list">
					<svg
						class="list"
						(click)="isList = true"
						[ngClass]="{ active: isList }"
						width="26"
						height="25"
					>
						<use
							xlink:href="/assets/images/service-grid-icon.svg#grid-list"
							href="/assets/images/service-grid-icon.svg#grid-list"
						></use>
					</svg>

					<svg
						width="26"
						height="25"
						(click)="isList = false"
						[ngClass]="{ active: !isList }"
						class="grid"
					>
						<use
							xlink:href="/assets/images/service-grid-icon.svg#grid-icon"
							href="/assets/images/service-grid-icon.svg#grid-icon"
						></use>
					</svg>
				</div>
			</div>
			<mat-drawer-container hasBackdrop="true">
				<mat-drawer #drawer mode="over">
					<mat-card class="filter-card no-card-shape">
						<div class="filtersSection w-bg">
							<img src="assets/images/brand.png" style="width: 200px; margin-bottom: 10px" />

							<div class="filtersSection__resetFilters">
								<mat-list-item>
									<button
										mat-button
										class="clear-filter"
										(click)="resetFilters()"
										[disabled]="userSegments?.length > 0"
									>
										<mat-icon>close</mat-icon> {{ 'CATALOG.REMOVE_FILTERS' | translate }}
									</button>
								</mat-list-item>
							</div>
							<ng-container *ngFor="let a of segmentType">
								<div class="filtersList" [style.display]="a.visible ? 'block' : 'none'">
									<div class="filtersList__head">
										{{ a['segmentTypeName_' + switchLangService.current] }}
									</div>
									<ng-container *ngFor="let b of segments">
										<div class="filtersList__item">
											<label class="label" for="{{ a?._id }}_{{ b?._id }}">
												<input
													type="checkbox"
													[disabled]="b.isDisabled"
													class="filterCheckbox__input"
													id="{{ a?._id }}_{{ b?._id }}"
													[(ngModel)]="segmentInput[a?._id][b?._id]"
													(change)="filterSegment()"
												/>
												<!-- <span class="text"> -->
												{{ b['segmentName_' + switchLangService.current] }}
												<!-- </span> -->
											</label>
										</div>
									</ng-container>
								</div>
							</ng-container>

							<mat-list-item class="filtersList__head" *ngIf="tags?.length"
								>{{ 'CATALOG.TAGS' | translate }}
							</mat-list-item>

							<ng-container *ngFor="let x of tags">
								<ion-chip (click)="changeTagStatus(x._id)" [class.selected-chip]="tagsInput[x._id]">
									<ion-label>{{ x.tag }}</ion-label>
								</ion-chip>
							</ng-container>

							<mat-list-item>
								<button mat-button class="w-100" (click)="drawer.toggle()">
									{{ 'CLOSE' | translate }}
								</button>
							</mat-list-item>
						</div>
					</mat-card>
				</mat-drawer>

				<mat-drawer-content class="row d-flex">
					<!-- <div class="row"> -->
					<div
						class="col-lg-3"
						style="display: none"
						[ngClass]="{
							alignSwitchAR: switchLangService.currentLang == 'ar',
							alignSwitchEN: switchLangService.currentLang == 'en'
						}"
					>
						<div class="d-none d-lg-block">
							<mat-card class="filter-card">
								<div class="filtersSection">
									<div class="filtersSection__resetFilters">
										<mat-list-item>
											<button
												mat-button
												class="clear-filter"
												(click)="resetFilters()"
												[disabled]="userSegments?.length > 0"
											>
												<mat-icon>close</mat-icon> {{ 'CATALOG.REMOVE_FILTERS' | translate }}
											</button>
										</mat-list-item>
									</div>
									<ng-container *ngFor="let a of segmentType">
										<div class="filtersList" [style.display]="a.visible ? 'block' : 'none'">
											<div class="filtersList__head">
												{{ a['segmentTypeName_' + switchLangService.current] }}
											</div>
											<ng-container *ngFor="let b of segments">
												<div
													*ngIf="
														b.segmentType?._id == a?._id && segmentInput && segmentInput[a?._id]
													"
												>
													<label class="label" for="{{ a?._id }}_{{ b?._id }}">
														<input
															type="checkbox"
															[disabled]="b.isDisabled"
															class="filterCheckbox__input"
															id="{{ a?._id }}_{{ b?._id }}"
															[(ngModel)]="segmentInput[a?._id][b?._id]"
															(change)="filterSegment()"
														/>
														{{ b['segmentName_' + switchLangService.current] }}
													</label>
												</div>
											</ng-container>
										</div>
									</ng-container>
								</div>
							</mat-card>
						</div>
						<div class="d-lg-none">
							<mat-card class="filter-card sm-filter-card" (click)="drawer.toggle()">
								<div class="sm-filter-container">
									<h5 class="mb-0 text-dark">
										{{ 'Filter' | translate }}
									</h5>
									<mat-icon>search</mat-icon>
								</div>
							</mat-card>
						</div>
					</div>

					<div
						class="col-lg-12"
						[ngClass]="{
							alignSwitchAR: switchLangService.currentLang == 'ar',
							alignSwitchEN: switchLangService.currentLang == 'en'
						}"
					>
						<!-- <mat-tab-group mat-stretch-tabs (selectedTabChange)='changeTap($event,departments)' class="example-stretched-tabs mat-elevation-z4"> -->
						<!-- <mat-tab label="{{'CATALOG.ALL_DEPARTMENTS' | translate}}"> -->
						<div class="category-content">
							<div class="row">
								<ng-container *ngFor="let x of filtered; trackBy: trackByFn">
									<app-service-card
										id="{{ x?._id }}"
										cardTitle="{{ x['serviceName_' + switchLangService.current] }}"
										text="{{ x['description_' + switchLangService.current] }}"
										class="{{ !isList ? 'col-lg-3' : 'col-lg-12 full-card' }}"
									>
									</app-service-card>
								</ng-container>
								<div class="col-lg-4">
									<div *ngIf="filtered?.length === 0">
										<mat-card>
											<h5>{{ 'CATALOG.NO_RESULTS_MATCHED_APPLIED_FILTERS' | translate }}</h5>
											<br />
											<button
												mat-stroked-button
												color="warn"
												(click)="resetFilters()"
												[disabled]="userSegments?.length > 0"
											>
												{{ 'CATALOG.REMOVE_ALL_SEARCH_PARAMS' | translate }}
											</button>
										</mat-card>
									</div>
								</div>
							</div>
							<div class="col-lg-12">
								<small *ngIf="filtered?.length != 0">
									{{ 'CATALOG.DISPLAY_RESULTS_COUNT' | translate }}
									{{ filtered?.length }}
									<ng-container *ngIf="filtered?.length != totalResult">
										{{ 'CATALOG.SERVICE_MATCHED_SEARCH_FROM_ORIGIN' | translate }}
										{{ totalResult }}</ng-container
									>
									{{ 'CATALOG.SERVICE' | translate }}
								</small>
							</div>
						</div>
						<!-- </mat-tab> -->
						<!-- <mat-tab *ngFor="let x of departments" label="{{x['departmentName_' + switchLangService.current]}}">
                              <ng-container *ngIf="dataFilters.category.department._id == x._id">
                                  <div class="category-filter">
                                      <ion-chip (click)="filterCategory(null)" [class.selected-chip]="dataFilters.category._id==null">
                                          <ion-label>{{"CATALOG.ALL_CATEGORIES" | translate}}</ion-label>
                                      </ion-chip>
                                      <ng-container *ngFor="let y of categories">
                                          <ion-chip (click)="filterCategory(y._id)" *ngIf="y.department._id == x._id" [class.selected-chip]="y._id==dataFilters.category._id">
                                              <ion-label> {{y['categoryName_' + switchLangService.current]}}
                                              </ion-label>
                                          </ion-chip>
                                      </ng-container>
                                  </div>
                              </ng-container>

                              <div class="category-content">
                                  <section fxLayout="row wrap" fxLayoutAlign="space-between top">
                                      <ng-container *ngFor="let x of filtered;trackBy: trackByFn">
                                          <app-service-card id="{{x?._id}}" cardTitle="{{x['serviceName_' + switchLangService.current]}}" text="{{x['description_' + switchLangService.current]}}" fxFlex="{{!isList?'49':'100'}}" fxFlex.xs="100">
                                          </app-service-card>
                                      </ng-container>

                                      <div *ngIf="(filtered)?.length === 0" fxLayout="row" fxLayoutAlign="center center">
                                          <mat-card>
                                              <h5>{{'CATALOG.NO_RESULTS_MATCHED_APPLIED_FILTERS' | translate}}
                                              </h5>
                                              <br>
                                              <button mat-stroked-button color="warn" (click)="resetFilters()" [disabled]="userSegments?.length>0">{{'CATALOG.REMOVE_ALL_SEARCH_PARAMS'
                                                  |
                                                  translate}}</button>
                                          </mat-card>
                                      </div>
                                  </section>

                                  <small *ngIf="(filtered)?.length != 0">
                                      {{'CATALOG.DISPLAY_RESULTS_COUNT' | translate }}
                                      {{(filtered)?.length}}
                                      <ng-container *ngIf="(filtered)?.length !=totalResult">
                                          {{'CATALOG.SERVICE_MATCHED_SEARCH_FROM_ORIGIN' | translate }}
                                          {{totalResult}}</ng-container>
                                      {{'CATALOG.SERVICE' | translate }}
                                  </small>
                              </div>
                          </mat-tab> -->
						<!-- </mat-tab-group> -->
					</div>
					<!-- </div> -->
				</mat-drawer-content>
			</mat-drawer-container>
		</div>
	</app-page>
</div>

<ng-template #alerts>
	<div class="padder">
		<div class="alert alert-warning-orange" *ngIf="!sessionService.isLicenseValid">
			<div class="row">
				<div class="col-auto align-self-start">
					<ion-icon [name]="'alert-circle-outline'" class="alert-icon"></ion-icon>
				</div>
				<div class="col">
					{{ 'LICENSE.ERROR' | translate }}
				</div>
			</div>
		</div>

		<div class="alert alert-warning" *ngIf="hasTask">
			<div class="row">
				<div class="col-auto align-self-start">
					<ion-icon [name]="'alert-circle-outline'" class="alert-icon"></ion-icon>
				</div>
				<div class="col">
					{{ 'CATALOG.needs' | translate }}
					<strong>{{ 'CATALOG.beneficiaryTask' | translate }}</strong>
					{{ 'CATALOG.pleasePress' | translate }}
					<a [routerLink]="['/requests/my', { u: 1 }]" class="alert-link">{{
						'CATALOG.hereToUpdate' | translate
					}}</a
					>.
				</div>
			</div>
		</div>
	</div>
</ng-template>
