<app-page pageTitleNarrow="{{ 'OPPORTUNITY.VIEW_PAGETITLE' | translate }}" hasBackButton="false">

  <div *appHasRole="['beneficiary']" [ngClass]="{'alignSwitchAR': switchLangService.currentLang=='ar', 'alignSwitchEN':switchLangService.currentLang=='en'}">

    <mat-card *ngIf="!isWithinDate">
        {{"OPPORTUNITY.NOT_AVAILABLE_DUE_TO_DATE" | translate}}
    </mat-card>

    <mat-card *ngIf="isAlreadyApplied">
        {{"OPPORTUNITY.ALREADY_APPLIED" | translate}}
    </mat-card>
  
    <div class="sideButtonContainer">
      <a mat-button mat-raised-button color="primary" [routerLink]="applyRoute" *ngIf="!isAlreadyApplied && isWithinDate">
          {{"OPPORTUNITY.APPLY" | translate}}
      </a>
    </div>
  </div>

  <formio *ngIf="formReady" [formKey]="'JobOpportunity-New'" [submission]="data"  [readOnly]="true"
    (customEvent)="onCustomEvent($event)" (submit)="onSubmit($event)" [ngClass]="{'alignSwitchAR': switchLangService.currentLang=='ar', 'alignSwitchEN':switchLangService.currentLang=='en'}">
  </formio>

  <div class="applicantsSection" *appHasRole="['department_specialist','ROLE_DEPARTMENT_ENABLEMENT_SPECIALIST']">
    <h3 class="applicantsSection__title">
        {{'OPPORTUNITY.APPLICANTS_LIST' | translate}}
    </h3>

  
    <table mat-table [dataSource]="applicants" class="applicantsSection__table">

      <!-- Position Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>{{'OPPORTUNITY.CANDIDATE_NAME' | translate}}</th>
        <td mat-cell *matCellDef="let element">
          <a mat-button mat-link-button color="primary" [routerLink]="'/opportunity/applied/'+element._id">
            {{element._fullName}}
          </a>
        </td>
      </ng-container>
    
      <!-- date Column -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef>{{'OPPORTUNITY.DATE' | translate}}</th>
        <td mat-cell *matCellDef="let element"> {{element._created * 1000  | date:"yyyy-MM-dd HH:mm"}} </td>
      </ng-container>


      <!-- nid Column -->
      <ng-container matColumnDef="nid">
        <th mat-header-cell *matHeaderCellDef>{{'OPPORTUNITY.NATIONAL_ID' | translate}}</th>
        <td mat-cell *matCellDef="let element"> {{element._nationalId}} </td>
      </ng-container>

      <!-- birthdate Column -->
      <ng-container matColumnDef="birthdate">
        <th mat-header-cell *matHeaderCellDef>{{'OPPORTUNITY.BIRTH_DATE' | translate}}</th>
        <td mat-cell *matCellDef="let element"> {{element._birthDate}} </td>
      </ng-container>


        <!-- mobile Column -->
      <ng-container matColumnDef="mobile">
          <th mat-header-cell *matHeaderCellDef>{{'OPPORTUNITY.MOBILE' | translate}}</th>
          <td mat-cell *matCellDef="let element"> {{element._mobile}} </td>
        </ng-container>


        <!-- city Column -->
      <ng-container matColumnDef="city">
          <th mat-header-cell *matHeaderCellDef>{{'OPPORTUNITY.CITY' | translate}}</th>
          <td mat-cell *matCellDef="let element"> {{element._created}} </td>
        </ng-container>


        <!-- title Column -->
      <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>{{'OPPORTUNITY.JOB_TITLE' | translate}}</th>
          <td mat-cell *matCellDef="let element"> {{res.name}} </td>
        </ng-container>

        <!-- education Column -->
      <ng-container matColumnDef="education">
          <th mat-header-cell *matHeaderCellDef>{{'OPPORTUNITY.EDUCATION' | translate}}</th>
          <td mat-cell *matCellDef="let element"> {{element.educationAndMajor}} </td>
        </ng-container>

      <!-- checkbox Column -->
      <ng-container matColumnDef="checkbox">
        <th mat-header-cell *matHeaderCellDef>
          <span *appHasRole="['department_specialist']">
            <mat-checkbox class="example-margin" (click)="selectAllCandidates()" (ngModel)="isAllCandidates">
                {{'OPPORTUNITY.CANDIDATE_SELECT' | translate}}
            </mat-checkbox>
          </span>
        </th>
        <td mat-cell *matCellDef="let element">
          <span *appHasRole="['department_specialist']">
            <mat-checkbox class="example-margin" [(ngModel)]="checkboxCandidates[element._id]"></mat-checkbox>
          </span>
        </td>
      </ng-container>


        <!-- details Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>
          {{'OPPORTUNITY.ACTIONS' | translate}}
        </th>
        <td mat-cell *matCellDef="let element">
            <a mat-button mat-link-button color="primary" [routerLink]="'/opportunity/applied/'+element._id">
              {{'OPPORTUNITY.CANDIDATE_VIEW' | translate}}
            </a>
        </td>
      </ng-container>
    
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>


    <div *appHasRole="['department_specialist']">
        <a mat-button mat-raised-button color="primary" class="applicantsSection__send" (click)="sendToCandidates()">
            {{"OPPORTUNITY.SEND_TO_CANDIDATES" | translate}}
        </a>
    </div>

    

  </div>

</app-page>